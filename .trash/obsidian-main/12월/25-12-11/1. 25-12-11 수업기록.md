#### 신규 CCTV 를 서울시 구별로 할당
- 화면 연결 후 최종: 그래서 구별로 몇개씩 할당하면 좋겠어? 질문에 답을 할 수 있도록

- 내가 작성한 프롬프트) 
	- 나는 이제 api를 사용하지 않고 @ai.aifixr.site/mlservice/app/seoul_crime/save/crime_with_gu.csv 이 자료를 DF 로 바꿔서 활용하고싶어. 그 활용 첫 번째로 히트맵을 그리고싶어.
	1. 일단 피처들이 범죄 종류(살인,강도,강간, 절도,폭력) 각각에 해당하는 발생과 검거로 나뉘고 있어. 
	2. 여기서 동일 자치구에 해당하는 관서가 2개 이상인 경우, 그 관서들의 범죄 종류(살인,강도,강간, 절도,폭력)별 발생 건 수를 합치고 싶어. 예를들어 중구에 해당하는 서울중부경찰서의 범죄 종류(살인,강도,강간, 절도,폭력)별 발생 건수를, 중구에 해당하는 서울 남대문 경찰서의 범죄 종류(살인,강도,강간, 절도,폭력)별 발생 건수와 합치고 싶다는 말이야. 
	3. 하나의 자치구에 하나의 관서만 있는 경우에는 그대로 값을 유지하면 돼
	4. 히트맵을 작성하는 위 과정에서 관서명은 필요 없어보이므로 히트맵 결과물에서는 관서명 피처와 칼럼값들은 삭제해도 좋아.
	5. 히트맵에는 정규화된 발생 건수의 값으로 정렬하고싶어. 
	6. 위 과정을 거치면 히트맵에 구별 범죄 종류(살인,강도,강간, 절도,폭력) 별로 발생 건수가 보이는데, 거기에 모든 범죄 종류의 발생 건수를 합한 "범죄" 항목을 추가해서, 지역구별 범죄 종류에 상관 없이 발생 건수를 합친 것 까지 히트맵에서 보고싶어. 
- GPT가 커서용으로 수정) 다음 전략을 실행해도 괜찮을까?
	- 🔥 **[Cursor 전략: 서울 범죄 데이터 히트맵 생성 매뉴얼]**
		  
		
		아래 데이터는 `@ai.aifixr.site/mlservice/app/seoul_crime/save/crime_with_gu.csv `에서 가져온 것이다.
		
		이 CSV 데이터 문자열을 DataFrame으로 변환한 후 아래 절차대로 처리해라.
		
		  
		
		---
		
		  
		
		## ✅ 1. **CSV 문자열 → DataFrame 변환**
		
		  
		
		* 구분자는 공백이 아니라 **쉼표(,)** 기준으로 변환된다.
		
		* 첫 번째 행은 컬럼명이다.
		
		* DataFrame을 불러온 후 **관서명, 자치구를 문자열 그대로 유지**한다.
		
		  
		
		---
		
		  
		
		## ✅ 2. **히트맵 생성에 필요한 컬럼만 남기기**
		
		  
		
		히트맵을 만들기 위해 필요한 컬럼은 다음과 같다:
		
		  
		
		* **자치구**
		
		* **살인 발생**
		
		* **강도 발생**
		
		* **강간 발생**
		
		* **절도 발생**
		
		* **폭력 발생**
		
		  
		
		검거 관련 컬럼은 히트맵에서는 사용하지 않으므로 삭제한다.
		
		또한 관서명도 히트맵에는 필요 없으므로 삭제한다.
		
		  
		
		---
		
		  
		
		## ✅ 3. **동일 자치구에 여러 관서가 있는 경우 발생 건수 합산**
		
		  
		
		예를 들어:
		
		  
		
		* 중구
		
		  
		
		* 서울중부경찰서 (발생 데이터 있음)
		
		* 서울남대문경찰서 (발생 데이터 있음)
		
		  
		
		→ 위 두 행을 **자치구 기준 groupby + sum**으로 합친다.
		
		  
		
		즉, 다음 작업 수행:
		
		  
		
		```
		
		df_grouped = df.groupby("자치구")[["살인 발생","강도 발생","강간 발생","절도 발생","폭력 발생"]].sum()
		
		```
		
		  
		
		이렇게 하면 자치구마다 단 하나의 행만 남는다.
		
		  
		
		---
		
		  
		
		## ✅ 4. **총 범죄 건수 컬럼 추가**
		
		  
		
		모든 범죄 종류를 합한 `범죄`라는 새로운 컬럼을 추가하라.
		
		  
		
		```
		
		df_grouped["범죄"] = df_grouped.sum(axis=1)
		
		```
		
		  
		
		이제 히트맵에는 6개의 컬럼이 존재하게 된다:
		
		  
		
		* 살인 발생
		
		* 강도 발생
		
		* 강간 발생
		
		* 절도 발생
		* 폭력 발생
		* **범죄(총합)**
		
		## ✅ 5. **정규화(Normalization) 수행**
		히트맵 색 비교를 위해 각 컬럼을 0~1 사이로 MinMax Scaling한다.
		```
		
		from sklearn.preprocessing import MinMaxScaler
		
		scaler = MinMaxScaler()
		
		df_norm = pd.DataFrame(
		
		scaler.fit_transform(df_grouped),
		
		columns=df_grouped.columns,
		
		index=df_grouped.index
		
		)
		
		```
		
		  
		
		---
		
		  
		
		## ✅ 6. **히트맵 2종 생성 (coolwarm, viridis)**
		
		  
		
		### (1) **coolwarm 히트맵**
		
		  
		
		```
		
		plt.figure(figsize=(12, 8))
		
		sns.heatmap(df_norm, annot=True, fmt=".2f", cmap="coolwarm")
		
		plt.title("서울시 범죄 발생 정규화 히트맵 (coolwarm)")
		
		plt.show()
		
		```
		
		  
		
		### (2) **viridis 히트맵**
		
		  
		
		```
		
		plt.figure(figsize=(12, 8))
		
		sns.heatmap(df_norm, annot=True, fmt=".2f", cmap="viridis")
		
		plt.title("서울시 범죄 발생 정규화 히트맵 (viridis)")
		
		plt.show()
		
		```
		
		  
		
		---
		
		  
		
		# ✨ [옵션 – 추천사항]
		
		  
		
		* 자치구 이름이 길면 회전해서 가독성을 높인다:
		
		  
		
		```
		
		plt.xticks(rotation=45)
		
		plt.yticks(rotation=0)
		
		```
		
		  
		
		* 숫자 포맷은 `.2f` 고정
		
		* 히트맵은 인덱스(자치구) 기준으로 자동 정렬된다.
		
		  
		
		---
		
		  
		
		# 🎯 **최종 출력물**
		
		  
		
		커서는 아래 두 이미지를 생성하면 된다.
		
		  
		
		1. **coolwarm 정규화 히트맵**
		
		2. **viridis 정규화 히트맵**
		
		  
		
		둘 다 자치구 × 범죄종류(살인·강도·강간·절도·폭력·총범죄) 구조.
		
		  
		
		---
		
		  
		
		필요하면 이 전략을 **좀 더 단순하게 줄이거나**,
		
		**코드 템플릿 형태로 바꿔줄 수도 있어!**
- CURSOR) 자치구 순서를 오름차순으로 하지 않고 정규화된 범죄 발생률 순서대로 하고싶어. 사진에서 동그라민 친 부분에 의해 정렬되게. 데이터 값은 다르지만 참고로 볼 수 있는 예시자료를 두번째 사진으로 참고해줘
- CURSOR) 음 이제 인구데이터 DF 를 활용해서 이걸 분모로 넣어야 지역구별 인구수 대비 발생률을 볼 수 있을 것 같은데, 어떻게 생각해?
#### 이론) geocoding = 지도 시각화, 히트맵, 폴리움

- 서울꺼 지도 그리기 전에 미국꺼로 (강사님이 주신 data 폴더 안에 있음)
- 아래 처럼 폴더 및 파일 추가
		 ![[Pasted image 20251211105333.png]]
- 다음 홈페이지에서 필요한 라이브버리 설치하기 https://python-visualization.github.io/folium/latest/getting_started.html
	- If you are using the Conda package manager, the equivalent is (아래거 다운로드)
			$ conda install folium -c conda-forge (밑에 과정으로 생략 가능)
		- ==ml 서비스의 requirements 파일 에 folium>=0.12.0 --> 이거 추가==
- 이미지까지 지우고 재빌드
- 위 사이트에서 맨 밑에 초록색 칠해진 지도에 해당하는 코드 복사해서 service.py 에 붙여넣기
- CURSOR) @ai.aifixr.site/mlservice/app/us_unemployment/service.py 이 코드를 OOP로 변경해줘 (--> 클래스로 바꾸는게 아주 중요!)
- CURSOR) @ai.aifixr.site/mlservice/app/us_unemployment/router.py 여기에 @ai.aifixr.site/mlservice/app/main.py 이것과 연동하여 전체 url이 localhost:8080/api/ml/usa 로 라우팅 해줘


- HTML -> 넥스트js에서 할 수 있도록 tsx로 바꿔줘
- 개인 도메인 홈페이지에 깃허브 링크 하나 주고, 개인 블로그 탭 만들어서 거기다가 기록해
- 서울크라임 폴더만 복사해서 폴더를 밖으로 빼 -> 이걸 깃허브에 올려서 홈페이지에 공유