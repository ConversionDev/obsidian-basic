# FastAPI EC2 ë°°í¬ ê°€ì´ë“œ

  

## ğŸ“‹ ì‚¬ì „ ì¤€ë¹„

  

### 1. GitHub Secrets ì„¤ì •

  

ì €ì¥ì†Œ Settings â†’ Secrets and variables â†’ Actionsì—ì„œ ë‹¤ìŒ secretsë¥¼ ì¶”ê°€:

  

```

EC2_HOST: ec2-13-209-7-140.ap-northeast-2.compute.amazonaws.com

EC2_USER: ubuntu

EC2_SSH_KEY: (elianayesol.pem íŒŒì¼ì˜ ì „ì²´ ë‚´ìš©)

POSTGRES_CONNECTION_STRING: (ë„¤ì˜¨ DB ì—°ê²° ë¬¸ìì—´)

LLM_PROVIDER: midm

LOCAL_MODEL_DIR: /home/ubuntu/app/backend/app/model/midm

```

  

**SSH í‚¤ ì¶”ê°€ ë°©ë²•:**

```bash

# Windows PowerShellì—ì„œ

Get-Content elianayesol.pem | Set-Clipboard

# ê·¸ ë‹¤ìŒ GitHub Secretsì— ë¶™ì—¬ë„£ê¸°

```

  

### 2. EC2 ì´ˆê¸° ì„¤ì • (í•œ ë²ˆë§Œ ì‹¤í–‰)

  

EC2ì— SSH ì ‘ì†í•œ í›„:

  

```bash

# ìŠ¤í¬ë¦½íŠ¸ë¥¼ EC2ë¡œ ë³µì‚¬

scp -i elianayesol.pem scripts/setup-ec2.sh ubuntu@ec2-13-209-7-140.ap-northeast-2.compute.amazonaws.com:~/

  

# EC2ì—ì„œ ì‹¤í–‰

ssh -i elianayesol.pem ubuntu@ec2-13-209-7-140.ap-northeast-2.compute.amazonaws.com

chmod +x ~/setup-ec2.sh

./setup-ec2.sh

```

  

### 3. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

  

EC2ì—ì„œ `.env` íŒŒì¼ ìƒì„±:

  

```bash

nano /home/ubuntu/app/backend/.env

```

  

ë‹¤ìŒ ë‚´ìš© ì¶”ê°€:

```env

DATABASE_URL=postgresql://neondb_owner:ë¹„ë°€ë²ˆí˜¸@ep-...neon.tech/neondb?sslmode=require

LLM_PROVIDER=midm

LOCAL_MODEL_DIR=/home/ubuntu/app/backend/app/model/midm

USE_MIDM=1

```

  

### 4. Mi:dm ëª¨ë¸ ì—…ë¡œë“œ

  

EC2ì— ëª¨ë¸ íŒŒì¼ ì—…ë¡œë“œ (ëŒ€ìš©ëŸ‰ íŒŒì¼ì´ë¯€ë¡œ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŒ):

  

```bash

# ë¡œì»¬ì—ì„œ ì‹¤í–‰

scp -i elianayesol.pem -r backend/app/model/midm ubuntu@ec2-13-209-7-140.ap-northeast-2.compute.amazonaws.com:/home/ubuntu/app/backend/app/model/

```

  

ë˜ëŠ” S3ë¥¼ ì‚¬ìš©:

```bash

# S3ì— ì—…ë¡œë“œ

aws s3 cp backend/app/model/midm s3://your-bucket/models/midm --recursive

  

# EC2ì—ì„œ ë‹¤ìš´ë¡œë“œ

aws s3 cp s3://your-bucket/models/midm /home/ubuntu/app/backend/app/model/midm --recursive

```

  

## ğŸš€ ìë™ ë°°í¬ (GitHub Actions)

  

### ë°°í¬ íŠ¸ë¦¬ê±°

  

`main` ë¸Œëœì¹˜ì— `backend/` í´ë”ì˜ ë³€ê²½ì‚¬í•­ì„ pushí•˜ë©´ ìë™ìœ¼ë¡œ ë°°í¬ë©ë‹ˆë‹¤:

  

```bash

git add backend/

git commit -m "Update backend code"

git push origin main

```

  

### ë°°í¬ í”„ë¡œì„¸ìŠ¤

  

1. GitHub Actionsê°€ ìë™ìœ¼ë¡œ íŠ¸ë¦¬ê±°ë¨

2. EC2ì— SSH ì ‘ì†

3. ìµœì‹  ì½”ë“œ pull

4. ì˜ì¡´ì„± ì„¤ì¹˜

5. ì„œë¹„ìŠ¤ ì¬ì‹œì‘

6. í—¬ìŠ¤ ì²´í¬

  

## ğŸ”§ ìˆ˜ë™ ë°°í¬

  

EC2ì— ì§ì ‘ ì ‘ì†í•˜ì—¬ ìˆ˜ë™ìœ¼ë¡œ ë°°í¬:

  

```bash

# ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ EC2ë¡œ ë³µì‚¬

scp -i elianayesol.pem scripts/deploy.sh ubuntu@ec2-13-209-7-140.ap-northeast-2.compute.amazonaws.com:~/

  

# EC2ì—ì„œ ì‹¤í–‰

ssh -i elianayesol.pem ubuntu@ec2-13-209-7-140.ap-northeast-2.compute.amazonaws.com

chmod +x ~/deploy.sh

./deploy.sh

```

  

ë˜ëŠ” ì§ì ‘ ëª…ë ¹ì–´ ì‹¤í–‰:

  

```bash

cd /home/ubuntu/app/backend

git pull origin main

source /home/ubuntu/app/venv/bin/activate

pip install -r requirements.txt

sudo systemctl restart fastapi

```

  

## ğŸ“Š ì„œë¹„ìŠ¤ ê´€ë¦¬

  

### ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸

```bash

sudo systemctl status fastapi

```

  

### ì„œë¹„ìŠ¤ ì‹œì‘/ì¤‘ì§€/ì¬ì‹œì‘

```bash

sudo systemctl start fastapi

sudo systemctl stop fastapi

sudo systemctl restart fastapi

```

  

### ë¡œê·¸ í™•ì¸

```bash

# ì‹¤ì‹œê°„ ë¡œê·¸

sudo journalctl -u fastapi -f

  

# ìµœê·¼ ë¡œê·¸

sudo journalctl -u fastapi -n 100

```

  

### í—¬ìŠ¤ ì²´í¬

```bash

curl http://localhost:8000/health

```

  

## ğŸ”’ ë³´ì•ˆ ì„¤ì •

  

### EC2 ë³´ì•ˆ ê·¸ë£¹

  

ì¸ë°”ìš´ë“œ ê·œì¹™ ì¶”ê°€:

- Type: Custom TCP

- Port: 8000

- Source: 0.0.0.0/0 (ë˜ëŠ” íŠ¹ì • IPë§Œ)

  

ë˜ëŠ” Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì‚¬ìš© (ê¶Œì¥):

- Port 80/443ë§Œ ì—´ê¸°

- Nginxê°€ 8000ë²ˆ í¬íŠ¸ë¡œ í”„ë¡ì‹œ

  

### ë°©í™”ë²½ ì„¤ì • (UFW)

```bash

sudo ufw allow 8000/tcp

sudo ufw enable

```

  

## ğŸ› ë¬¸ì œ í•´ê²°

  

### ì„œë¹„ìŠ¤ê°€ ì‹œì‘ë˜ì§€ ì•Šì„ ë•Œ

```bash

# ì—ëŸ¬ í™•ì¸

sudo journalctl -u fastapi -n 50

  

# ìˆ˜ë™ ì‹¤í–‰ìœ¼ë¡œ ì—ëŸ¬ í™•ì¸

cd /home/ubuntu/app/backend

source /home/ubuntu/app/venv/bin/activate

python -m backend.app.main

```

  

### í¬íŠ¸ê°€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¼ ë•Œ

```bash

# í”„ë¡œì„¸ìŠ¤ í™•ì¸

sudo lsof -i :8000

# í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ

sudo kill -9 <PID>

```

  

### ì˜ì¡´ì„± ì„¤ì¹˜ ì‹¤íŒ¨

```bash

# ê°€ìƒí™˜ê²½ ì¬ìƒì„±

rm -rf /home/ubuntu/app/venv

python3 -m venv /home/ubuntu/app/venv

source /home/ubuntu/app/venv/bin/activate

pip install --upgrade pip

pip install -r requirements.txt

```

  

## ğŸ“ ì°¸ê³ ì‚¬í•­

  

- ë°°í¬ëŠ” `main` ë¸Œëœì¹˜ì—ë§Œ ìë™ìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤

- `backend/` í´ë” ì™¸ì˜ ë³€ê²½ì‚¬í•­ì€ ë°°í¬ë¥¼ íŠ¸ë¦¬ê±°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤

- ë°°í¬ ì¤‘ ì„œë¹„ìŠ¤ê°€ ì ì‹œ ì¤‘ë‹¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (5-10ì´ˆ)

- ëª¨ë¸ íŒŒì¼ì€ ë°°í¬ ì‹œ ì—…ë°ì´íŠ¸ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (ë³„ë„ ì—…ë¡œë“œ í•„ìš”)