# 카카오 로그인 구현 가이드

  

## 📋 목차

1. [전체 플로우 개요](#전체-플로우-개요)

2. [백엔드 구현](#백엔드-구현)

3. [프론트엔드 구현](#프론트엔드-구현)

4. [카카오 개발자 콘솔 설정](#카카오-개발자-콘솔-설정)

5. [현재 완료된 기능](#현재-완료된-기능)

  

---

  

## 🔄 전체 플로우 개요

  

### 간단한 설명

카카오 로그인은 3단계로 진행됩니다:

  

```

1단계: 사용자가 "카카오 로그인" 버튼 클릭

   ↓

2단계: 카카오 인증 페이지에서 로그인 및 동의

   ↓

3단계: 로그인 성공 후 우리 서비스로 돌아와서 토큰 받기

```

  

### 상세 플로우

  

```

[사용자] → [프론트엔드] → [백엔드] → [카카오] → [백엔드] → [프론트엔드]

```

  

1. **사용자가 카카오 로그인 버튼 클릭**

   - 프론트엔드: `GET /api/auth/kakao/auth-url` 요청

   - 백엔드: 카카오 인증 URL 생성 후 반환

  

2. **카카오 인증 페이지로 이동**

   - 사용자가 카카오 계정으로 로그인

   - 동의 항목 확인 (이메일, 닉네임 등)

  

3. **카카오가 백엔드로 리다이렉트**

   - 카카오 → 백엔드: `http://localhost:8080/api/auth/kakao/callback?code=인가코드`

   - 백엔드: 인가 코드로 카카오 액세스 토큰 받기

   - 백엔드: 액세스 토큰으로 사용자 정보 조회

   - 백엔드: JWT 토큰 생성

  

4. **프론트엔드로 토큰 전달** (현재는 fallback 방식 사용)

   - 프론트엔드: `POST /api/auth/kakao/login` 요청 (인가 코드 전송)

   - 백엔드: JWT 토큰 반환

   - 프론트엔드: 토큰을 localStorage에 저장

  

5. **대시보드로 이동**

   - 로그인 성공 화면 표시

   - 사용자 정보 표시

  

---

  

## 🔧 백엔드 구현

  

### 1. 주요 컴포넌트

  

#### ✅ KakaoController.java

```java

@RestController

@RequestMapping("/kakao")

public class KakaoController {

    // 카카오 인증 URL 생성

    @GetMapping("/auth-url")

    public ResponseEntity<Map<String, String>> getKakaoAuthUrl() {

        // 카카오 REST API 키는 환경 변수에서 가져옴 (보안)

        String authUrl = kakaoService.generateAuthUrl();

        return ResponseEntity.ok(Map.of("authUrl", authUrl));

    }

    // 카카오 로그인 처리 (인가 코드로 토큰 발급)

    @PostMapping("/login")

    public ResponseEntity<Map<String, Object>> kakaoLogin(@RequestBody Map<String, String> body) {

        String code = body.get("code");

        // 1. 인가 코드로 카카오 액세스 토큰 받기

        // 2. 액세스 토큰으로 사용자 정보 조회

        // 3. JWT 토큰 생성

        // 4. 응답 반환

    }

    // 카카오 콜백 처리 (GET 요청)

    @GetMapping("/callback")

    public ResponseEntity<Map<String, Object>> kakaoCallback(@RequestParam String code) {

        // POST /login과 동일한 로직

    }

}

```

  

#### ✅ KakaoService.java

```java

@Service

public class KakaoService {

    // 카카오 인증 URL 생성

    public String generateAuthUrl() {

        // 카카오 REST API 키는 환경 변수에서 가져옴

        // redirect_uri는 백엔드 콜백 주소: http://localhost:8080/api/auth/kakao/callback

    }

    // 인가 코드로 카카오 액세스 토큰 받기

    public String getAccessToken(String code) {

        // 카카오 API 호출: POST https://kauth.kakao.com/oauth/token

    }

    // 액세스 토큰으로 사용자 정보 조회

    public KakaoUserInfo getUserInfo(String accessToken) {

        // 카카오 API 호출: GET https://kapi.kakao.com/v2/user/me

    }

}

```

  

#### ✅ JwtTokenProvider.java

```java

@Component

public class JwtTokenProvider {

    // JWT 토큰 생성

    public String generateToken(Map<String, Object> claims) {

        // 사용자 정보를 JWT 토큰으로 변환

    }

    // JWT 토큰 검증

    public boolean validateToken(String token) {

        // 토큰 유효성 검증

    }

}

```

  

### 2. 환경 변수 설정

  

백엔드 `.env` 파일 또는 `application.yaml`:

```yaml

KAKAO_REST_API_KEY: your_kakao_rest_api_key

KAKAO_REDIRECT_URI: http://localhost:8080/api/auth/kakao/callback

```

  

**중요**: API 키는 절대 프론트엔드에 노출하지 않습니다!

  

### 3. 게이트웨이 설정

  

`application.yaml`:

```yaml

spring:

  cloud:

    gateway:

      routes:

        - id: auth-service-route

          uri: http://authservice:8081

          predicates:

            - Path=/api/auth/**

          filters:

            - RewritePath=/api/auth/(?<segment>.*), /${segment}

```

  

**설명**:

- 프론트엔드 요청: `/api/auth/kakao/login`

- 게이트웨이 변환: `/kakao/login`

- 백엔드 서비스로 전달

  

---

  

## 💻 프론트엔드 구현

  

### 1. 로그인 페이지 (`app/page.tsx`)

  

```typescript

const handleKakaoLogin = async () => {

  // 1. 백엔드에서 카카오 인증 URL 받아오기

  const res = await fetch("http://localhost:8080/api/auth/kakao/auth-url", {

    method: "GET",

  });

  const data = await res.json();

  // 2. 카카오 인증 페이지로 리다이렉트

  window.location.href = data.authUrl;

};

```

  

**설명**:

- 프론트엔드는 API 키를 모릅니다 (보안)

- 백엔드에서 인증 URL을 받아서 사용합니다

  

### 2. 콜백 페이지 (`app/auth/kakao/callback/page.tsx`)

  

```typescript

useEffect(() => {

  // 케이스 1: 백엔드가 토큰을 쿼리 파라미터로 전달한 경우

  const token = searchParams.get("token");

  if (token) {

    localStorage.setItem("access_token", token);

    router.push("/dashboard");

    return;

  }

  // 케이스 2: 인가 코드만 전달된 경우 (현재 사용 중)

  const code = searchParams.get("code");

  if (code) {

    // 백엔드로 인가 코드 전송하여 토큰 받기

    const res = await fetch("http://localhost:8080/api/auth/kakao/login", {

      method: "POST",

      body: JSON.stringify({ code }),

    });

    const data = await res.json();

    localStorage.setItem("access_token", data.token);

    router.push("/dashboard");

  }

}, []);

```

  

**설명**:

- 카카오가 백엔드로 리다이렉트한 후, 프론트엔드가 인가 코드를 받아서 백엔드로 전송

- 백엔드가 JWT 토큰을 반환하면 localStorage에 저장

  

### 3. 대시보드 페이지 (`app/dashboard/page.tsx`)

  

```typescript

useEffect(() => {

  // localStorage에서 토큰 확인

  const token = localStorage.getItem("access_token");

  if (!token) {

    router.push("/"); // 토큰이 없으면 로그인 페이지로

    return;

  }

  // 사용자 정보 표시

  const userInfo = localStorage.getItem("user_info");

  // ...

}, []);

  

const handleLogout = () => {

  // 토큰 삭제

  localStorage.removeItem("access_token");

  localStorage.removeItem("user_info");

  router.push("/");

};

```

  

---

  

## 🔐 카카오 개발자 콘솔 설정

  

### 1. 카카오 개발자 콘솔 접속

- https://developers.kakao.com/

- 내 애플리케이션 → 앱 선택

  

### 2. 플랫폼 설정

1. **앱 설정** → **플랫폼**

2. **Web 플랫폼 등록**

   - 사이트 도메인: `http://localhost:3000`

  

### 3. 카카오 로그인 활성화

1. **제품 설정** → **카카오 로그인** → **활성화 설정** → **활성화**

2. **Redirect URI 등록**

   - `http://localhost:8080/api/auth/kakao/callback`

   - ⚠️ **중요**: 백엔드 콜백 주소를 등록합니다!

  

### 4. 동의 항목 설정

1. **제품 설정** → **카카오 로그인** → **동의항목**

2. 필요한 항목 활성화:

   - 이메일 (필수 또는 선택)

   - 닉네임 (필수 또는 선택)

   - 프로필 사진 (선택)

  

### 5. REST API 키 확인

1. **앱 설정** → **앱 키**

2. **REST API 키** 복사

3. 백엔드 환경 변수에 설정

  

---

  

## ✅ 현재 완료된 기능

  

### 백엔드

- ✅ 카카오 인증 URL 생성 (`GET /api/auth/kakao/auth-url`)

- ✅ 카카오 OAuth 인증 처리 (`GET /api/auth/kakao/callback`)

- ✅ 인가 코드로 액세스 토큰 받기

- ✅ 액세스 토큰으로 사용자 정보 조회

- ✅ JWT 토큰 발급 (`POST /api/auth/kakao/login`)

- ✅ API 키 보안 (환경 변수로 관리, 프론트엔드에 노출 안 됨)

  

### 프론트엔드

- ✅ 카카오 로그인 버튼

- ✅ 백엔드에서 인증 URL 받아오기

- ✅ 카카오 인증 페이지로 리다이렉트

- ✅ 콜백 페이지에서 인가 코드 처리

- ✅ JWT 토큰 저장 (localStorage)

- ✅ 대시보드에서 토큰 확인 및 사용자 정보 표시

- ✅ 로그아웃 기능

  

---

  

## 🔄 현재 플로우 (Fallback 방식)

  

```

1. 사용자: 카카오 로그인 버튼 클릭

   ↓

2. 프론트엔드: GET /api/auth/kakao/auth-url

   ↓

3. 백엔드: 카카오 인증 URL 반환

   ↓

4. 프론트엔드: 카카오 인증 페이지로 리다이렉트

   ↓

5. 사용자: 카카오에서 로그인 및 동의

   ↓

6. 카카오: 백엔드로 리다이렉트

   http://localhost:8080/api/auth/kakao/callback?code=인가코드

   ↓

7. 백엔드: 인가 코드로 토큰 발급 및 사용자 정보 조회

   (현재는 프론트엔드로 자동 리다이렉트하지 않음)

   ↓

8. 프론트엔드: POST /api/auth/kakao/login (인가 코드 전송)

   ↓

9. 백엔드: JWT 토큰 반환

   ↓

10. 프론트엔드: 토큰 저장 후 대시보드로 이동

```

  

---

  

## 🚀 향후 개선 사항

  

### 백엔드에서 프론트엔드로 자동 리다이렉트 (권장)

현재는 프론트엔드가 인가 코드를 받아서 백엔드로 다시 요청하는 방식입니다.

  

**개선 방안**:

- 백엔드가 카카오 콜백을 처리한 후 프론트엔드로 자동 리다이렉트

- URL 형식: `http://localhost:3000/auth/kakao/callback?token=JWT_TOKEN&user=USER_INFO`

- 프론트엔드는 이미 이 케이스를 처리할 수 있도록 구현되어 있음

  

---

  

## 📝 핵심 포인트

  

### 보안

1. **API 키는 절대 프론트엔드에 노출하지 않음**

   - 백엔드 환경 변수에서만 관리

   - 프론트엔드는 백엔드 API를 통해서만 카카오 인증 URL 받기

  

2. **JWT 토큰 관리**

   - localStorage에 저장 (현재)

   - 향후 httpOnly 쿠키로 변경 고려

  

### 플로우 이해

1. **OAuth 2.0 인증 코드 플로우**

   - 인가 코드 → 액세스 토큰 → 사용자 정보

  

2. **게이트웨이 역할**

   - 프론트엔드와 백엔드 서비스 사이의 중간자

   - 경로 변환 및 라우팅

  

3. **콜백 주소**

   - 카카오 개발자 콘솔: 백엔드 콜백 주소 등록

   - 백엔드: 카카오로부터 인가 코드 받기

   - 프론트엔드: 최종 결과 받기

  

---

  

## 🎯 요약

  

### 오늘 완료한 것

1. ✅ 카카오 로그인 전체 플로우 구현

2. ✅ 보안: API 키를 프론트엔드에 노출하지 않음

3. ✅ JWT 토큰 발급 및 저장

4. ✅ 사용자 정보 조회 및 표시

  

### 다음 단계 (선택사항)

1. 백엔드에서 프론트엔드로 자동 리다이렉트 구현

2. 토큰 갱신 로직 추가

3. 에러 처리 개선

  

---

  

**작성일**: 2025년 1월

**상태**: 기본 기능 완료 ✅