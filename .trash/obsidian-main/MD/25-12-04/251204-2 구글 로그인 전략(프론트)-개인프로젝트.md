# êµ¬ê¸€ ë¡œê·¸ì¸ ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ

  

ë‹¤ë¥¸ ì»¤ì„œ AIì—ê²Œ ì „ë‹¬í•˜ê¸° ìœ„í•œ ê°„ë‹¨ ìš”ì•½ ë²„ì „ì…ë‹ˆë‹¤.

  

## ğŸ¯ ì‘ì—… ëª©í‘œ

  

Next.js í”„ë¡œì íŠ¸ì— êµ¬ê¸€ OAuth ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

  

## ğŸ“‹ ì „ì œ ì¡°ê±´

  

- Next.js 16+ (App Router)

- TypeScript

- Tailwind CSS

- ë°±ì—”ë“œ API ì„œë²„ (Spring Boot ë“±)

  

## ğŸš€ 5ë¶„ êµ¬í˜„ ê°€ì´ë“œ

  

### 1ï¸âƒ£ ì„œë¹„ìŠ¤ ë¡œì§ ìƒì„± (service/mainservice.ts)

  

```typescript

export const { handleGoogleLogin } = (() => {

Â  const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:8080';

  

Â  async function requestAuthUrl(provider: string, errorMessage: string) {

Â  Â  try {

Â  Â  Â  const res = await fetch(`${API_BASE_URL}/api/auth/${provider}/auth-url`, {

Â  Â  Â  Â  method: "GET",

Â  Â  Â  Â  headers: { "Content-Type": "application/json" },

Â  Â  Â  });

  

Â  Â  Â  if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);

  

Â  Â  Â  const data = await res.json();

Â  Â  Â  if (data.authUrl) {

Â  Â  Â  Â  window.location.href = data.authUrl;

Â  Â  Â  } else {

Â  Â  Â  Â  throw new Error(`${provider} ì¸ì¦ URLì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.`);

Â  Â  Â  }

Â  Â  } catch (error) {

Â  Â  Â  console.error(`${provider} ë¡œê·¸ì¸ URL ìš”ì²­ ì‹¤íŒ¨:`, error);

Â  Â  Â  alert(errorMessage);

Â  Â  }

Â  }

  

Â  async function handleGoogleLogin() {

Â  Â  await requestAuthUrl("google", "êµ¬ê¸€ ë¡œê·¸ì¸ì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

Â  }

  

Â  return { handleGoogleLogin };

})();

```

  

### 2ï¸âƒ£ ë¡œê·¸ì¸ ë²„íŠ¼ ì¶”ê°€ (app/page.tsx)

  

```typescript

"use client";

  

import { handleGoogleLogin } from "@/service/mainservice";

  

export default function Home() {

Â  return (

Â  Â  <button onClick={handleGoogleLogin}>

Â  Â  Â  êµ¬ê¸€ ë¡œê·¸ì¸

Â  Â  </button>

Â  );

}

```

  

### 3ï¸âƒ£ ì½œë°± í˜ì´ì§€ ìƒì„± (app/auth/google/callback/page.tsx)

  

```typescript

"use client";

  

import { useEffect, useState } from "react";

import { useRouter, useSearchParams } from "next/navigation";

  

export default function GoogleCallbackPage() {

Â  const router = useRouter();

Â  const searchParams = useSearchParams();

Â  const [status, setStatus] = useState<"loading" | "success" | "error">("loading");

Â  const [message, setMessage] = useState("êµ¬ê¸€ ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘...");

  

Â  useEffect(() => {

Â  Â  const handleCallback = async () => {

Â  Â  Â  try {

Â  Â  Â  Â  const token = searchParams.get("token");

Â  Â  Â  Â  const error = searchParams.get("error");

  

Â  Â  Â  Â  if (error) {

Â  Â  Â  Â  Â  setStatus("error");

Â  Â  Â  Â  Â  setMessage(`ë¡œê·¸ì¸ ì‹¤íŒ¨: ${error}`);

Â  Â  Â  Â  Â  setTimeout(() => router.push("/"), 3000);

Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  }

  

Â  Â  Â  Â  if (token) {

Â  Â  Â  Â  Â  localStorage.setItem("access_token", token);

Â  Â  Â  Â  Â  const userInfo = searchParams.get("user");

Â  Â  Â  Â  Â  if (userInfo) localStorage.setItem("user_info", userInfo);

Â  Â  Â  Â  Â  setStatus("success");

Â  Â  Â  Â  Â  setMessage("ë¡œê·¸ì¸ ì„±ê³µ!");

Â  Â  Â  Â  Â  setTimeout(() => router.push("/dashboard"), 1500);

Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  }

  

Â  Â  Â  Â  // Fallback: ì½”ë“œë¡œ í† í° ë°›ê¸°

Â  Â  Â  Â  const code = searchParams.get("code");

Â  Â  Â  Â  if (!code) throw new Error("ì¸ê°€ ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.");

  

Â  Â  Â  Â  const res = await fetch("http://localhost:8080/api/auth/google/login", {

Â  Â  Â  Â  Â  method: "POST",

Â  Â  Â  Â  Â  headers: { "Content-Type": "application/json" },

Â  Â  Â  Â  Â  body: JSON.stringify({ code }),

Â  Â  Â  Â  });

  

Â  Â  Â  Â  const data = await res.json();

Â  Â  Â  Â  if (!res.ok) throw new Error(data.message);

  

Â  Â  Â  Â  if (data.token) {

Â  Â  Â  Â  Â  localStorage.setItem("access_token", data.token);

Â  Â  Â  Â  Â  if (data.user) localStorage.setItem("user_info", JSON.stringify(data.user));

Â  Â  Â  Â  Â  setStatus("success");

Â  Â  Â  Â  Â  setTimeout(() => router.push("/dashboard"), 1500);

Â  Â  Â  Â  }

Â  Â  Â  } catch (error) {

Â  Â  Â  Â  console.error("ë¡œê·¸ì¸ ì‹¤íŒ¨:", error);

Â  Â  Â  Â  setStatus("error");

Â  Â  Â  Â  setMessage("ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");

Â  Â  Â  Â  setTimeout(() => router.push("/"), 3000);

Â  Â  Â  }

Â  Â  };

  

Â  Â  handleCallback();

Â  }, [searchParams, router]);

  

Â  return (

Â  Â  <div className="flex min-h-screen items-center justify-center">

Â  Â  Â  {status === "loading" && <p>ë¡œë”© ì¤‘...</p>}

Â  Â  Â  {status === "success" && <p>{message}</p>}

Â  Â  Â  {status === "error" && <p className="text-red-600">{message}</p>}

Â  Â  </div>

Â  );

}

```

  

### 4ï¸âƒ£ ëŒ€ì‹œë³´ë“œ ìƒì„± (app/dashboard/page.tsx)

  

```typescript

"use client";

  

import { useEffect, useState } from "react";

import { useRouter } from "next/navigation";

  

export default function DashboardPage() {

Â  const router = useRouter();

Â  const [token, setToken] = useState<string | null>(null);

  

Â  useEffect(() => {

Â  Â  const storedToken = localStorage.getItem("access_token");

Â  Â  if (!storedToken) {

Â  Â  Â  router.push("/");

Â  Â  Â  return;

Â  Â  }

Â  Â  setToken(storedToken);

Â  }, [router]);

  

Â  const handleLogout = () => {

Â  Â  localStorage.removeItem("access_token");

Â  Â  localStorage.removeItem("user_info");

Â  Â  router.push("/");

Â  };

  

Â  if (!token) return <p>ë¡œë”© ì¤‘...</p>;

  

Â  return (

Â  Â  <div>

Â  Â  Â  <h1>ë¡œê·¸ì¸ ì„±ê³µ!</h1>

Â  Â  Â  <button onClick={handleLogout}>ë¡œê·¸ì•„ì›ƒ</button>

Â  Â  </div>

Â  );

}

```

  

## ğŸ”§ í™˜ê²½ ì„¤ì •

  

### .env.local

```env

NEXT_PUBLIC_API_BASE_URL=http://localhost:8080

```

  

### tsconfig.json

```json

{

Â  "compilerOptions": {

Â  Â  "paths": {

Â  Â  Â  "@/*": ["./*"]

Â  Â  }

Â  }

}

```

  

## ğŸ–¥ï¸ ë°±ì—”ë“œ ìš”êµ¬ì‚¬í•­

  

### í•„ìˆ˜ ì—”ë“œí¬ì¸íŠ¸ 3ê°œ

  

#### 1. ì¸ì¦ URL ì¡°íšŒ

```

GET /api/auth/google/auth-url

  

Response:

{

Â  "authUrl": "https://accounts.google.com/o/oauth2/v2/auth?..."

}

```

  

#### 2. ì½œë°± ì²˜ë¦¬ (ë°±ì—”ë“œì—ì„œ)

```

GET /api/auth/google/callback?code=...

  

â†’ ë¦¬ë‹¤ì´ë ‰íŠ¸: http://localhost:3000/auth/google/callback?token=JWT_TOKEN&user={...}

```

  

#### 3. ë¡œê·¸ì¸ ì²˜ë¦¬ (fallback)

```

POST /api/auth/google/login

  

Body: { "code": "..." }

  

Response:

{

Â  "token": "JWT_TOKEN",

Â  "token_type": "Bearer",

Â  "user": {

Â  Â  "email": "user@example.com",

Â  Â  "name": "User Name"

Â  }

}

```

  

## ğŸ“‚ ìµœì¢… íŒŒì¼ êµ¬ì¡°

  

```

í”„ë¡œì íŠ¸/

â”œâ”€â”€ service/

â”‚ Â  â””â”€â”€ mainservice.ts

â”œâ”€â”€ app/

â”‚ Â  â”œâ”€â”€ page.tsx

â”‚ Â  â”œâ”€â”€ auth/

â”‚ Â  â”‚ Â  â””â”€â”€ google/

â”‚ Â  â”‚ Â  Â  Â  â””â”€â”€ callback/

â”‚ Â  â”‚ Â  Â  Â  Â  Â  â””â”€â”€ page.tsx

â”‚ Â  â””â”€â”€ dashboard/

â”‚ Â  Â  Â  â””â”€â”€ page.tsx

â”œâ”€â”€ .env.local

â””â”€â”€ tsconfig.json

```

  

## ğŸ”„ ë¡œê·¸ì¸ í”Œë¡œìš°

  

```

1. ì‚¬ìš©ì í´ë¦­ "êµ¬ê¸€ ë¡œê·¸ì¸" ë²„íŠ¼

Â  Â â†“

2. GET /api/auth/google/auth-url (ì¸ì¦ URL ìš”ì²­)

Â  Â â†“

3. êµ¬ê¸€ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

Â  Â â†“

4. êµ¬ê¸€ â†’ ë°±ì—”ë“œ: GET /api/auth/google/callback?code=...

Â  Â â†“

5. ë°±ì—”ë“œ: ì½”ë“œ â†’ ì•¡ì„¸ìŠ¤ í† í° â†’ ì‚¬ìš©ì ì •ë³´ â†’ JWT ìƒì„±

Â  Â â†“

6. ë°±ì—”ë“œ â†’ í”„ë¡ íŠ¸: ë¦¬ë‹¤ì´ë ‰íŠ¸ /auth/google/callback?token=...

Â  Â â†“

7. í”„ë¡ íŠ¸: localStorageì— í† í° ì €ì¥

Â  Â â†“

8. ëŒ€ì‹œë³´ë“œë¡œ ì´ë™

```

  

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

  

### í”„ë¡ íŠ¸ì—”ë“œ

- [ ] `service/mainservice.ts` ìƒì„±

- [ ] `app/page.tsx`ì— ë¡œê·¸ì¸ ë²„íŠ¼ ì¶”ê°€

- [ ] `app/auth/google/callback/page.tsx` ìƒì„±

- [ ] `app/dashboard/page.tsx` ìƒì„±

- [ ] `.env.local`ì— ë°±ì—”ë“œ URL ì„¤ì •

- [ ] `tsconfig.json`ì— ê²½ë¡œ ë³„ì¹­ í™•ì¸

  

### ë°±ì—”ë“œ

- [ ] GET `/api/auth/google/auth-url` ì—”ë“œí¬ì¸íŠ¸

- [ ] GET `/api/auth/google/callback` ì—”ë“œí¬ì¸íŠ¸

- [ ] POST `/api/auth/google/login` ì—”ë“œí¬ì¸íŠ¸ (fallback)

- [ ] CORS ì„¤ì •

- [ ] JWT í† í° ìƒì„± ë¡œì§

  

### í…ŒìŠ¤íŠ¸

- [ ] ë°±ì—”ë“œ ì„œë²„ ì‹¤í–‰ (í¬íŠ¸ 8080)

- [ ] í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ ì‹¤í–‰ (í¬íŠ¸ 3000)

- [ ] ë¸Œë¼ìš°ì €ì—ì„œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸

- [ ] í† í° ì €ì¥ í™•ì¸ (ê°œë°œì ë„êµ¬ â†’ Application â†’ Local Storage)

- [ ] ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ í™•ì¸

  

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

  

| ë¬¸ì œ | ì›ì¸ | í•´ê²° |

|------|------|------|

| CORS ì—ëŸ¬ | ë°±ì—”ë“œ CORS ë¯¸ì„¤ì • | ë°±ì—”ë“œì— CORS ì„¤ì • ì¶”ê°€ |

| 404 ì—ëŸ¬ | ì—”ë“œí¬ì¸íŠ¸ ê²½ë¡œ ë¶ˆì¼ì¹˜ | URL ê²½ë¡œ í™•ì¸ |

| í† í° ì €ì¥ ì•ˆ ë¨ | localStorage ì ‘ê·¼ ì‹¤íŒ¨ | ë¸Œë¼ìš°ì € ì½˜ì†” í™•ì¸ |

| ë¬´í•œ ë¦¬ë‹¤ì´ë ‰íŠ¸ | í† í° í™•ì¸ ë¡œì§ ì˜¤ë¥˜ | ëŒ€ì‹œë³´ë“œ useEffect í™•ì¸ |

  

## ğŸ“š ì¶”ê°€ ìë£Œ

  

- **ìƒì„¸ ê°€ì´ë“œ**: `êµ¬ê¸€_ë¡œê·¸ì¸_êµ¬í˜„_ì „ëµ.md`

- **ì½”ë“œ í…œí”Œë¦¿**: `êµ¬ê¸€_ë¡œê·¸ì¸_ì½”ë“œ_í…œí”Œë¦¿/` í´ë”

  

## ğŸ¨ UI ê°œì„  (ì„ íƒì‚¬í•­)

  

Tailwind CSSë¥¼ ì‚¬ìš©í•˜ì—¬ ë²„íŠ¼ì„ ë” ì˜ˆì˜ê²Œ:

  

```typescript

<button

Â  onClick={handleGoogleLogin}

Â  className="flex h-14 w-full items-center justify-center gap-3 rounded-lg border border-gray-300 bg-white px-6 text-base font-medium text-gray-700 transition-colors hover:bg-gray-50"

>

Â  <svg className="h-5 w-5" viewBox="0 0 24 24">

Â  Â  {/* êµ¬ê¸€ ë¡œê³  SVG ê²½ë¡œ */}

Â  </svg>

Â  êµ¬ê¸€ ë¡œê·¸ì¸

</button>

```

  

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

  

âš ï¸ **ì£¼ì˜**: í˜„ì¬ êµ¬í˜„ì€ localStorage ì‚¬ìš© (XSS ì·¨ì•½)

  

í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ”:

- httpOnly ì¿ í‚¤ ì‚¬ìš©

- HTTPS ì‚¬ìš© í•„ìˆ˜

- state íŒŒë¼ë¯¸í„°ë¡œ CSRF ë°©ì§€

  

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

  

### ë‹¤ë¥¸ ì†Œì…œ ë¡œê·¸ì¸ ì¶”ê°€

  

ì¹´ì¹´ì˜¤/ë„¤ì´ë²„ë„ ë™ì¼í•œ íŒ¨í„´ìœ¼ë¡œ ì¶”ê°€ ê°€ëŠ¥:

  

```typescript

// service/mainservice.tsì— ì¶”ê°€

async function handleKakaoLogin() {

Â  await requestAuthUrl("kakao", "ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹¤íŒ¨");

}

  

return {

Â  handleGoogleLogin,

Â  handleKakaoLogin, // ì¶”ê°€

};

```

  

ê°™ì€ ë°©ì‹ìœ¼ë¡œ `app/auth/kakao/callback/page.tsx` ìƒì„±

  

## ğŸ“ ë¬¸ì œ ë°œìƒ ì‹œ

  

1. ë¸Œë¼ìš°ì € ì½˜ì†” í™•ì¸

2. Network íƒ­ì—ì„œ API ìš”ì²­ í™•ì¸

3. localStorage í™•ì¸

4. ë°±ì—”ë“œ ë¡œê·¸ í™•ì¸

  

---

  

**ì‘ì„±ì¼**: 2025-01-25 Â 

**í…ŒìŠ¤íŠ¸ í™˜ê²½**: Next.js 16, React 19, TypeScript 5