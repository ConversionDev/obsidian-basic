# Redis ë¬´ìƒíƒœ í”„ë¡œê·¸ë˜ë° í†µí•© ì „ëµ

  

**ë²„ì „**: 1.0 Â 

**ìµœì¢… ìˆ˜ì •ì¼**: 2024-11-21 Â 

**ìƒíƒœ**: âœ… êµ¬í˜„ ì™„ë£Œ

  

---

  

## ğŸ“‹ ëª©ì°¨

  

1. [ê°œìš”](#ê°œìš”)

2. [Redis í†µí•© ì•„í‚¤í…ì²˜](#redis-í†µí•©-ì•„í‚¤í…ì²˜)

3. [ë¬´ìƒíƒœ í”„ë¡œê·¸ë˜ë° ì „ëµ](#ë¬´ìƒíƒœ-í”„ë¡œê·¸ë˜ë°-ì „ëµ)

4. [Redis ì‚¬ìš© ì‚¬ë¡€](#redis-ì‚¬ìš©-ì‚¬ë¡€)

5. [ì„¤ì • ê°€ì´ë“œ](#ì„¤ì •-ê°€ì´ë“œ)

6. [ë³´ì•ˆ ê³ ë ¤ì‚¬í•­](#ë³´ì•ˆ-ê³ ë ¤ì‚¬í•­)

7. [ëª¨ë‹ˆí„°ë§ ë° ìš´ì˜](#ëª¨ë‹ˆí„°ë§-ë°-ìš´ì˜)

  

---

  

## 1. ê°œìš”

  

### 1.1 ëª©ì 

  

ì´ í”„ë¡œì íŠ¸ëŠ” **ë¬´ìƒíƒœ(Stateless) í”„ë¡œê·¸ë˜ë°**ì„ ìœ„í•´ Redisë¥¼ í†µí•©í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì€ ëª©í‘œë¥¼ ë‹¬ì„±í•©ë‹ˆë‹¤:

  

- âœ… **ì„¸ì…˜ ê´€ë¦¬**: ì„œë²„ ê°„ ì„¸ì…˜ ê³µìœ 

- âœ… **í† í° ê´€ë¦¬**: JWT Refresh Token ë° Blacklist ê´€ë¦¬

- âœ… **ìºì‹œ ë ˆì´ì–´**: ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ ë‹¤ì¸µ ìºì‹œ ì „ëµ

- âœ… **Rate Limiting**: API ìš”ì²­ ì œí•œ ë° ë³´ì•ˆ ê°•í™”

- âœ… **ë¶„ì‚° ë½**: ë™ì‹œì„± ì œì–´

- âœ… **ì‹¤ì‹œê°„ ë°ì´í„°**: ì‹¤ì‹œê°„ ì ìˆ˜ ë° ëŒ€ì‹œë³´ë“œ ë°ì´í„° ìºì‹±

  

### 1.2 Redis ë²„ì „ ë° ì„¤ì •

  

```yaml

Image: redis:7-alpine

Port: 6379

Persistence: AOF (Append Only File) í™œì„±í™”

Password: í™˜ê²½ ë³€ìˆ˜ë¡œ ê´€ë¦¬ (ê¸°ë³¸ê°’: Redis0930!)

```

  

---

  

## 2. Redis í†µí•© ì•„í‚¤í…ì²˜

  

### 2.1 Docker Compose êµ¬ì¡°

  

```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

â”‚ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Spring Network Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  â”‚

â”‚ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  â”‚

â”‚ Â â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Â â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Â â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Â  Â  Â  Â  Â  Â â”‚

â”‚ Â â”‚ Â Redis Â  â”‚ Â â”‚ Â Postgresâ”‚ Â â”‚ Â Eureka Â â”‚ Â  Â  Â  Â  Â  Â â”‚

â”‚ Â â”‚ Â :6379 Â  â”‚ Â â”‚ Â :5432 Â  â”‚ Â â”‚ Â :8761 Â  â”‚ Â  Â  Â  Â  Â  Â â”‚

â”‚ Â â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ Â â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ Â â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ Â  Â  Â  Â  Â  Â â”‚

â”‚ Â  Â  Â  â”‚ Â  Â  Â  Â  Â  Â  â”‚ Â  Â  Â  Â  Â  Â  Â â”‚ Â  Â  Â  Â  Â  Â  Â  Â  Â  â”‚

â”‚ Â  Â  Â  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Â  Â  Â  Â  Â  Â  Â  Â  Â  â”‚

â”‚ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  â”‚ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â â”‚

â”‚ Â â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Â  Â  Â  Â  Â  Â  Â â”‚

â”‚ Â â”‚ Â  Â  Â  Â  Â  Â  Â  Â  Â â”‚ Â  Â  Â  Â  Â  Â  Â  Â  Â â”‚ Â  Â  Â  Â  Â  Â  Â â”‚

â”‚ Â â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Â â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Â â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Â  Â  Â  Â  Â  Â â”‚

â”‚ Â â”‚ Discoveryâ”‚ Â â”‚ Â Config Â â”‚ Â â”‚ Services â”‚ Â  Â  Â  Â  Â  Â â”‚

â”‚ Â â”‚ Â :8080 Â  â”‚ Â â”‚ Â :8888 Â  â”‚ Â â”‚ Â :810x Â  â”‚ Â  Â  Â  Â  Â  Â â”‚

â”‚ Â â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Â â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Â â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Â  Â  Â  Â  Â  Â â”‚

â”‚ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

  

### 2.2 ì„œë¹„ìŠ¤ ì˜ì¡´ì„±

  

ëª¨ë“  Spring ì„œë¹„ìŠ¤ëŠ” Redisì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤:

  

- âœ… **config-server**: Redis ì„¤ì • ì •ë³´ ì œê³µ

- âœ… **eureka-server**: ì„œë¹„ìŠ¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ìºì‹±

- âœ… **discovery-server**: Rate Limiting, ì„¸ì…˜ ê´€ë¦¬

- âœ… **ëª¨ë“  ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤**: ìºì‹œ, í† í° ê´€ë¦¬, ë¶„ì‚° ë½

  

### 2.3 ë„¤íŠ¸ì›Œí¬ ì„¤ì •

  

```yaml

networks:

Â  spring-network:

Â  Â  driver: bridge

  

# RedisëŠ” ëª¨ë“  ì„œë¹„ìŠ¤ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥

aliases:

Â  - redis.local

Â  - redis

```

  

---

  

## 3. ë¬´ìƒíƒœ í”„ë¡œê·¸ë˜ë° ì „ëµ

  

### 3.1 ì„¸ì…˜ ê´€ë¦¬ (Spring Session)

  

**ëª©ì **: ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ ê°„ ì„¸ì…˜ ê³µìœ 

  

```java

// application.yaml

spring:

Â  session:

Â  Â  store-type: redis

Â  Â  redis:

Â  Â  Â  host: ${REDIS_HOST:redis}

Â  Â  Â  port: ${REDIS_PORT:6379}

Â  Â  Â  password: ${REDIS_PASSWORD}

Â  Â  Â  timeout: 2000ms

```

  

**ì¥ì **:

- ë¡œë“œ ë°¸ëŸ°ì„œ ë’¤ì—ì„œ ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ ì‹¤í–‰ ì‹œ ì„¸ì…˜ ê³µìœ 

- ì„œë²„ ì¬ì‹œì‘ ì‹œì—ë„ ì„¸ì…˜ ìœ ì§€

- í™•ì¥ì„± í–¥ìƒ

  

### 3.2 í† í° ê´€ë¦¬

  

#### 3.2.1 Refresh Token ì €ì¥

  

```java

// Key: token:refresh:{userId}

// Value: { refreshToken, expiresAt, role }

// TTL: 1ê°œì›”, 3ê°œì›”, 6ê°œì›” (ì‚¬ìš©ì ì„ íƒ)

  

redisTemplate.opsForValue().set(

Â  Â  "token:refresh:user123",

Â  Â  refreshTokenData,

Â  Â  90, // 3ê°œì›”

Â  Â  TimeUnit.DAYS

);

```

  

#### 3.2.2 Token Blacklist

  

```java

// Key: token:blacklist:{tokenId}

// Value: { tokenId, expiresAt }

// TTL: Access Token ë§Œë£Œ ì‹œê°„ê³¼ ë™ì¼

  

redisTemplate.opsForValue().set(

Â  Â  "token:blacklist:tokenId123",

Â  Â  blacklistData,

Â  Â  accessTokenExpiration,

Â  Â  TimeUnit.SECONDS

);

```

  

### 3.3 ìºì‹œ ì „ëµ

  

í”„ë¡œì íŠ¸ ë¬¸ì„œ(`FRONTEND_BACKEND_CONNECTION_STRATEGY.md`)ì— ëª…ì‹œëœ ìºì‹œ ì „ëµ:

  

#### 3.3.1 Public ìºì‹œ (ê³µê°œ ë°ì´í„°)

  

```

Key Pattern: public:{clientId}:finalReport:{fiscalYear}

TTL: 30ì¼

ìš©ë„: ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ìë„ ì ‘ê·¼ ê°€ëŠ¥í•œ ê³µê°œ ë³´ê³ ì„œ

```

  

#### 3.3.2 Client ìºì‹œ (ê³ ê°ì‚¬ ì „ìš©)

  

```

Key Pattern: client:{clientId}:diagnosis:summary

TTL: 5ë¶„ ~ 1ì‹œê°„

ìš©ë„: ì‹¤ì‹œê°„ ìê°€ì§„ë‹¨ ì ìˆ˜, ëŒ€ì‹œë³´ë“œ KPI

```

  

#### 3.3.3 Admin ìºì‹œ (ê´€ë¦¬ì ì „ìš©)

  

```

Key Pattern: admin:statistics:monthly

TTL: 1ì‹œê°„

ìš©ë„: ê´€ë¦¬ì í†µê³„, ì „ì²´ ê³ ê°ì‚¬ ìš”ì•½

```

  

### 3.4 Rate Limiting (API ìš”ì²­ ì œí•œ)

  

**Discovery Server (Gateway)ì—ì„œ êµ¬í˜„**:

  

```yaml

# application.yaml

spring:

Â  cloud:

Â  Â  gateway:

Â  Â  Â  routes:

Â  Â  Â  Â  - id: soccer-service

Â  Â  Â  Â  Â  filters:

Â  Â  Â  Â  Â  Â  - name: RequestRateLimiter

Â  Â  Â  Â  Â  Â  Â  args:

Â  Â  Â  Â  Â  Â  Â  Â  redis-rate-limiter.replenishRate: 10 Â # ì´ˆë‹¹ 10ê°œ ìš”ì²­

Â  Â  Â  Â  Â  Â  Â  Â  redis-rate-limiter.burstCapacity: 20 Â # ìµœëŒ€ 20ê°œ ë²„ìŠ¤íŠ¸

Â  Â  Â  Â  Â  Â  Â  Â  redis-rate-limiter.requestedTokens: 1

```

  

**ì¥ì **:

- DDoS ê³µê²© ë°©ì–´

- API ë‚¨ìš© ë°©ì§€

- ì„œë²„ ë¶€í•˜ ê°ì†Œ

  

### 3.5 ë¶„ì‚° ë½ (Distributed Lock)

  

**ë™ì‹œì„± ì œì–´ë¥¼ ìœ„í•œ ë¶„ì‚° ë½**:

  

```java

@Autowired

private RedisTemplate<String, String> redisTemplate;

  

public void processCriticalSection(String lockKey) {

Â  Â  String lockValue = UUID.randomUUID().toString();

Â  Â  Boolean acquired = redisTemplate.opsForValue()

Â  Â  Â  Â  .setIfAbsent(lockKey, lockValue, 30, TimeUnit.SECONDS);

Â  Â  if (Boolean.TRUE.equals(acquired)) {

Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  // Critical section

Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  // Lock í•´ì œ (Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ ì•ˆì „í•˜ê²Œ)

Â  Â  Â  Â  Â  Â  String script = "if redis.call('get', KEYS[1]) == ARGV[1] then " +

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "return redis.call('del', KEYS[1]) else return 0 end";

Â  Â  Â  Â  Â  Â  redisTemplate.execute(

Â  Â  Â  Â  Â  Â  Â  Â  new DefaultRedisScript<>(script, Long.class),

Â  Â  Â  Â  Â  Â  Â  Â  Collections.singletonList(lockKey),

Â  Â  Â  Â  Â  Â  Â  Â  lockValue

Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  }

Â  Â  }

}

```

  

---

  

## 4. Redis ì‚¬ìš© ì‚¬ë¡€

  

### 4.1 ì‹¤ì‹œê°„ ìê°€ì§„ë‹¨ ì ìˆ˜

  

```java

@Service

public class DiagnosisService {

Â  Â  @Cacheable(value = "client",

Â  Â  Â  Â  Â  Â  Â  Â key = "'client:' + #clientId + ':diagnosis:summary'")

Â  Â  public DiagnosisSummary getSummary(String clientId) {

Â  Â  Â  Â  // Redisì—ì„œ ì¡°íšŒ ì‹œë„

Â  Â  Â  Â  // Cache Miss ì‹œ DB ì¡°íšŒ í›„ Redisì— ì €ì¥ (TTL: 5ë¶„)

Â  Â  }

Â  Â  @CacheEvict(value = "client",

Â  Â  Â  Â  Â  Â  Â  Â  key = "'client:' + #clientId + ':diagnosis:summary'")

Â  Â  public void updateDiagnosis(String clientId, DiagnosisRequest request) {

Â  Â  Â  Â  // DB ì—…ë°ì´íŠ¸ í›„ Redis ìºì‹œ ë¬´íš¨í™”

Â  Â  Â  Â  // Write-Through: ì¦‰ì‹œ Redisì— ì—…ë°ì´íŠ¸

Â  Â  }

}

```

  

### 4.2 ê³µê°œ ìµœì¢… ë³´ê³ ì„œ

  

```java

@Service

public class ReportService {

Â  Â  public FinalReport getPublicReport(String clientId, int fiscalYear) {

Â  Â  Â  Â  String cacheKey = String.format(

Â  Â  Â  Â  Â  Â  "public:%s:finalReport:%d", clientId, fiscalYear

Â  Â  Â  Â  );

Â  Â  Â  Â  // Cache-Aside íŒ¨í„´

Â  Â  Â  Â  FinalReport cached = (FinalReport) redisTemplate.opsForValue()

Â  Â  Â  Â  Â  Â  .get(cacheKey);

Â  Â  Â  Â  if (cached != null) {

Â  Â  Â  Â  Â  Â  return cached;

Â  Â  Â  Â  }

Â  Â  Â  Â  // DBì—ì„œ ì¡°íšŒ

Â  Â  Â  Â  FinalReport report = reportRepository.findByClientIdAndYear(

Â  Â  Â  Â  Â  Â  clientId, fiscalYear

Â  Â  Â  Â  );

Â  Â  Â  Â  // Redisì— ìºì‹œ ì €ì¥ (TTL: 30ì¼)

Â  Â  Â  Â  if (report != null) {

Â  Â  Â  Â  Â  Â  redisTemplate.opsForValue().set(

Â  Â  Â  Â  Â  Â  Â  Â  cacheKey, report, 30, TimeUnit.DAYS

Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  }

Â  Â  Â  Â  return report;

Â  Â  }

}

```

  

### 4.3 ì¸ì¦ í† í° ê´€ë¦¬

  

```java

@Service

public class TokenService {

Â  Â  public void saveRefreshToken(String userId, RefreshToken token) {

Â  Â  Â  Â  String key = "token:refresh:" + userId;

Â  Â  Â  Â  redisTemplate.opsForValue().set(

Â  Â  Â  Â  Â  Â  key, token, token.getExpirationDays(), TimeUnit.DAYS

Â  Â  Â  Â  );

Â  Â  }

Â  Â  public RefreshToken getRefreshToken(String userId) {

Â  Â  Â  Â  String key = "token:refresh:" + userId;

Â  Â  Â  Â  return (RefreshToken) redisTemplate.opsForValue().get(key);

Â  Â  }

Â  Â  public void blacklistToken(String tokenId, long expirationSeconds) {

Â  Â  Â  Â  String key = "token:blacklist:" + tokenId;

Â  Â  Â  Â  redisTemplate.opsForValue().set(

Â  Â  Â  Â  Â  Â  key, tokenId, expirationSeconds, TimeUnit.SECONDS

Â  Â  Â  Â  );

Â  Â  }

Â  Â  public boolean isTokenBlacklisted(String tokenId) {

Â  Â  Â  Â  String key = "token:blacklist:" + tokenId;

Â  Â  Â  Â  return redisTemplate.hasKey(key);

Â  Â  }

}

```

  

---

  

## 5. ì„¤ì • ê°€ì´ë“œ

  

### 5.1 Spring Boot Redis ì„¤ì •

  

#### 5.1.1 ì˜ì¡´ì„± ì¶”ê°€ (build.gradle)

  

```gradle

dependencies {

Â  Â  implementation 'org.springframework.boot:spring-boot-starter-data-redis'

Â  Â  implementation 'org.springframework.boot:spring-boot-starter-cache'

Â  Â  implementation 'org.springframework.session:spring-session-data-redis'

}

```

  

#### 5.1.2 Redis Configuration

  

```java

@Configuration

@EnableCaching

public class RedisConfig {

Â  Â  @Value("${REDIS_HOST:redis}")

Â  Â  private String redisHost;

Â  Â  @Value("${REDIS_PORT:6379}")

Â  Â  private int redisPort;

Â  Â  @Value("${REDIS_PASSWORD:}")

Â  Â  private String redisPassword;

Â  Â  @Bean

Â  Â  public RedisConnectionFactory redisConnectionFactory() {

Â  Â  Â  Â  RedisStandaloneConfiguration config = new RedisStandaloneConfiguration();

Â  Â  Â  Â  config.setHostName(redisHost);

Â  Â  Â  Â  config.setPort(redisPort);

Â  Â  Â  Â  if (StringUtils.hasText(redisPassword)) {

Â  Â  Â  Â  Â  Â  config.setPassword(redisPassword);

Â  Â  Â  Â  }

Â  Â  Â  Â  return new LettuceConnectionFactory(config);

Â  Â  }

Â  Â  @Bean

Â  Â  public RedisTemplate<String, Object> redisTemplate(

Â  Â  Â  Â  Â  Â  RedisConnectionFactory connectionFactory) {

Â  Â  Â  Â  RedisTemplate<String, Object> template = new RedisTemplate<>();

Â  Â  Â  Â  template.setConnectionFactory(connectionFactory);

Â  Â  Â  Â  template.setKeySerializer(new StringRedisSerializer());

Â  Â  Â  Â  template.setValueSerializer(new GenericJackson2JsonRedisSerializer());

Â  Â  Â  Â  template.setHashKeySerializer(new StringRedisSerializer());

Â  Â  Â  Â  template.setHashValueSerializer(new GenericJackson2JsonRedisSerializer());

Â  Â  Â  Â  return template;

Â  Â  }

Â  Â  @Bean

Â  Â  public CacheManager cacheManager(RedisConnectionFactory connectionFactory) {

Â  Â  Â  Â  RedisCacheConfiguration defaultConfig = RedisCacheConfiguration

Â  Â  Â  Â  Â  Â  .defaultCacheConfig()

Â  Â  Â  Â  Â  Â  .entryTtl(Duration.ofMinutes(5))

Â  Â  Â  Â  Â  Â  .serializeKeysWith(RedisSerializationContext.SerializationPair

Â  Â  Â  Â  Â  Â  Â  Â  .fromSerializer(new StringRedisSerializer()))

Â  Â  Â  Â  Â  Â  .serializeValuesWith(RedisSerializationContext.SerializationPair

Â  Â  Â  Â  Â  Â  Â  Â  .fromSerializer(new GenericJackson2JsonRedisSerializer()));

Â  Â  Â  Â  Map<String, RedisCacheConfiguration> cacheConfigurations = new HashMap<>();

Â  Â  Â  Â  // Public ìºì‹œ: 30ì¼

Â  Â  Â  Â  cacheConfigurations.put("public", defaultConfig

Â  Â  Â  Â  Â  Â  .entryTtl(Duration.ofDays(30)));

Â  Â  Â  Â  // Client ìºì‹œ: 5ë¶„

Â  Â  Â  Â  cacheConfigurations.put("client", defaultConfig

Â  Â  Â  Â  Â  Â  .entryTtl(Duration.ofMinutes(5)));

Â  Â  Â  Â  // Admin ìºì‹œ: 1ì‹œê°„

Â  Â  Â  Â  cacheConfigurations.put("admin", defaultConfig

Â  Â  Â  Â  Â  Â  .entryTtl(Duration.ofHours(1)));

Â  Â  Â  Â  // Token ìºì‹œ: 3ê°œì›”

Â  Â  Â  Â  cacheConfigurations.put("token", defaultConfig

Â  Â  Â  Â  Â  Â  .entryTtl(Duration.ofDays(90)));

Â  Â  Â  Â  return RedisCacheManager.builder(connectionFactory)

Â  Â  Â  Â  Â  Â  .cacheDefaults(defaultConfig)

Â  Â  Â  Â  Â  Â  .withInitialCacheConfigurations(cacheConfigurations)

Â  Â  Â  Â  Â  Â  .build();

Â  Â  }

}

```

  

#### 5.1.3 application.yaml ì„¤ì •

  

```yaml

spring:

Â  data:

Â  Â  redis:

Â  Â  Â  host: ${REDIS_HOST:redis}

Â  Â  Â  port: ${REDIS_PORT:6379}

Â  Â  Â  password: ${REDIS_PASSWORD:}

Â  Â  Â  timeout: 2000ms

Â  Â  Â  lettuce:

Â  Â  Â  Â  pool:

Â  Â  Â  Â  Â  max-active: 8

Â  Â  Â  Â  Â  max-idle: 8

Â  Â  Â  Â  Â  min-idle: 0

Â  session:

Â  Â  store-type: redis

Â  Â  redis:

Â  Â  Â  host: ${REDIS_HOST:redis}

Â  Â  Â  port: ${REDIS_PORT:6379}

Â  Â  Â  password: ${REDIS_PASSWORD:}

```

  

### 5.2 í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

  

`.env` íŒŒì¼ ìƒì„± (ì„ íƒì‚¬í•­):

  

```env

REDIS_PASSWORD=YourSecurePassword123!

```

  

ë˜ëŠ” docker-compose ì‹¤í–‰ ì‹œ:

  

```bash

REDIS_PASSWORD=YourSecurePassword123! docker-compose up -d

```

  

---

  

## 6. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

  

### 6.1 ë¯¼ê°ì •ë³´ ë³´í˜¸ ì •ì±…

  

**âŒ Redisì— ì ˆëŒ€ ì €ì¥í•˜ì§€ ì•ŠëŠ” ë°ì´í„°**:

- ê°œì¸ì •ë³´ (ì´ë¦„, ì£¼ë¯¼ë²ˆí˜¸, ì—°ë½ì²˜)

- ì¬ë¬´ ìƒì„¸ ì •ë³´ (ë§¤ì¶œ, ë¹„ìš© ìƒì„¸)

- ë‚´ë¶€ ê°ì‚¬ ì›ë³¸ ë°ì´í„°

- ë¹„ìŠ¹ì¸ ë¯¼ê° ë°ì´í„°

  

**âœ… Redisì— ì €ì¥ ê°€ëŠ¥í•œ ë°ì´í„°**:

- í† í° (ì•”í˜¸í™”ëœ Refresh Token)

- ìºì‹œëœ ìš”ì•½ ë°ì´í„° (ë¹„ë¯¼ê° ì •ë³´ë§Œ)

- ê³µê°œ ë³´ê³ ì„œ ë©”íƒ€ë°ì´í„°

- ì‹¤ì‹œê°„ ì ìˆ˜ (ìµëª…í™”ëœ ë°ì´í„°)

  

### 6.2 Redis ë¹„ë°€ë²ˆí˜¸ ì„¤ì •

  

```yaml

# docker-compose.yaml

command: redis-server --appendonly yes --requirepass ${REDIS_PASSWORD:-Redis0930!}

```

  

**í”„ë¡œë•ì…˜ í™˜ê²½ ê¶Œì¥ì‚¬í•­**:

- ê°•ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ ì‚¬ìš© (ìµœì†Œ 16ì, íŠ¹ìˆ˜ë¬¸ì í¬í•¨)

- í™˜ê²½ ë³€ìˆ˜ë¡œ ê´€ë¦¬ (ì ˆëŒ€ ì½”ë“œì— í•˜ë“œì½”ë”© ê¸ˆì§€)

- ì •ê¸°ì ì¸ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½

  

### 6.3 ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬

  

- RedisëŠ” `spring-network` ë‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥

- ì™¸ë¶€ í¬íŠ¸ ë…¸ì¶œì€ ê°œë°œ í™˜ê²½ì—ì„œë§Œ (í”„ë¡œë•ì…˜ì—ì„œëŠ” ì œê±° ê¶Œì¥)

- ë°©í™”ë²½ ê·œì¹™ìœ¼ë¡œ ì¶”ê°€ ë³´ì•ˆ ê°•í™”

  

### 6.4 ë°ì´í„° ì•”í˜¸í™”

  

ë¯¼ê°í•œ í† í° ë°ì´í„°ëŠ” ì €ì¥ ì „ ì•”í˜¸í™”:

  

```java

@Service

public class TokenService {

Â  Â  @Autowired

Â  Â  private EncryptionService encryptionService;

Â  Â  public void saveRefreshToken(String userId, RefreshToken token) {

Â  Â  Â  Â  // í† í° ì•”í˜¸í™”

Â  Â  Â  Â  String encryptedToken = encryptionService.encrypt(token.getToken());

Â  Â  Â  Â  token.setToken(encryptedToken);

Â  Â  Â  Â  // Redisì— ì €ì¥

Â  Â  Â  Â  redisTemplate.opsForValue().set(

Â  Â  Â  Â  Â  Â  "token:refresh:" + userId,

Â  Â  Â  Â  Â  Â  token,

Â  Â  Â  Â  Â  Â  token.getExpirationDays(),

Â  Â  Â  Â  Â  Â  TimeUnit.DAYS

Â  Â  Â  Â  );

Â  Â  }

}

```

  

---

  

## 7. ëª¨ë‹ˆí„°ë§ ë° ìš´ì˜

  

### 7.1 Redis Health Check

  

Docker Composeì—ì„œ ìë™ìœ¼ë¡œ Health Check ìˆ˜í–‰:

  

```yaml

healthcheck:

Â  test: ["CMD", "redis-cli", "ping"]

Â  interval: 10s

Â  timeout: 3s

Â  retries: 5

Â  start_period: 10s

```

  

### 7.2 Redis ëª¨ë‹ˆí„°ë§ ëª…ë ¹ì–´

  

```bash

# Redis ì»¨í…Œì´ë„ˆ ì ‘ì†

docker exec -it redis redis-cli

  

# ë¹„ë°€ë²ˆí˜¸ ì¸ì¦

AUTH Redis0930!

  

# ì—°ê²° ìƒíƒœ í™•ì¸

PING

  

# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸

INFO memory

  

# í‚¤ ê°œìˆ˜ í™•ì¸

DBSIZE

  

# íŠ¹ì • íŒ¨í„´ì˜ í‚¤ ì¡°íšŒ

KEYS token:*

  

# í‚¤ì˜ TTL í™•ì¸

TTL token:refresh:user123

  

# í†µê³„ ì •ë³´

INFO stats

```

  

### 7.3 ë¡œê·¸ ëª¨ë‹ˆí„°ë§

  

```bash

# Redis ë¡œê·¸ í™•ì¸

docker logs redis

  

# ì‹¤ì‹œê°„ ë¡œê·¸ ëª¨ë‹ˆí„°ë§

docker logs -f redis

```

  

### 7.4 ë°±ì—… ë° ë³µêµ¬

  

#### 7.4.1 AOF (Append Only File) ë°±ì—…

  

RedisëŠ” AOF ëª¨ë“œë¡œ ì‹¤í–‰ë˜ì–´ ëª¨ë“  ì“°ê¸° ì‘ì—…ì´ ë¡œê·¸ íŒŒì¼ì— ê¸°ë¡ë©ë‹ˆë‹¤:

  

```yaml

command: redis-server --appendonly yes

volumes:

Â  - redis-data:/data

```

  

#### 7.4.2 ìˆ˜ë™ ë°±ì—…

  

```bash

# Redis ë°ì´í„° ë°±ì—…

docker exec redis redis-cli --rdb /data/dump.rdb

  

# ë³¼ë¥¨ ë°±ì—…

docker run --rm -v app.aifixr.site_redis-data:/data -v $(pwd):/backup \

Â  alpine tar czf /backup/redis-backup-$(date +%Y%m%d).tar.gz /data

```

  

### 7.5 ì„±ëŠ¥ ìµœì í™”

  

#### 7.5.1 Connection Pool ì„¤ì •

  

```yaml

spring:

Â  data:

Â  Â  redis:

Â  Â  Â  lettuce:

Â  Â  Â  Â  pool:

Â  Â  Â  Â  Â  max-active: 8 Â  Â # ìµœëŒ€ ì—°ê²° ìˆ˜

Â  Â  Â  Â  Â  max-idle: 8 Â  Â  Â # ìµœëŒ€ ìœ íœ´ ì—°ê²° ìˆ˜

Â  Â  Â  Â  Â  min-idle: 0 Â  Â  Â # ìµœì†Œ ìœ íœ´ ì—°ê²° ìˆ˜

```

  

#### 7.5.2 ë©”ëª¨ë¦¬ ê´€ë¦¬

  

- TTLì„ ì ì ˆíˆ ì„¤ì •í•˜ì—¬ ì˜¤ë˜ëœ ë°ì´í„° ìë™ ì‚­ì œ

- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§

- í•„ìš” ì‹œ `maxmemory-policy` ì„¤ì • (ì˜ˆ: `allkeys-lru`)

  

---

  

## 8. ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

  

### 8.1 ê¸°ì¡´ ì„œë¹„ìŠ¤ì— Redis ì¶”ê°€

  

1. **ì˜ì¡´ì„± ì¶”ê°€**: `build.gradle`ì— Redis ì˜ì¡´ì„± ì¶”ê°€

2. **ì„¤ì • ì¶”ê°€**: `RedisConfig` í´ë˜ìŠ¤ ìƒì„±

3. **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**: `application.yaml`ì— Redis ì—°ê²° ì •ë³´ ì¶”ê°€

4. **ìºì‹œ ì–´ë…¸í…Œì´ì…˜ ì ìš©**: `@Cacheable`, `@CacheEvict` ë“± ì‚¬ìš©

5. **í…ŒìŠ¤íŠ¸**: ë¡œì»¬ì—ì„œ Redis ì—°ê²° í…ŒìŠ¤íŠ¸

  

### 8.2 ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜

  

1. **1ë‹¨ê³„**: í† í° ê´€ë¦¬ë¶€í„° ì‹œì‘ (ê°€ì¥ ì¤‘ìš”)

2. **2ë‹¨ê³„**: ìºì‹œ ë ˆì´ì–´ ì¶”ê°€ (ì„±ëŠ¥ ê°œì„ )

3. **3ë‹¨ê³„**: Rate Limiting ì ìš© (ë³´ì•ˆ ê°•í™”)

4. **4ë‹¨ê³„**: ì„¸ì…˜ ê´€ë¦¬ (ë¬´ìƒíƒœ ì™„ì„±)

  

---

  

## 9. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

  

### 9.1 ì—°ê²° ì‹¤íŒ¨

  

**ì¦ìƒ**: `Unable to connect to Redis`

  

**í•´ê²° ë°©ë²•**:

1. Redis ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸: `docker ps | grep redis`

2. ë„¤íŠ¸ì›Œí¬ í™•ì¸: `docker network inspect spring-network`

3. ë¹„ë°€ë²ˆí˜¸ í™•ì¸: í™˜ê²½ ë³€ìˆ˜ `REDIS_PASSWORD` í™•ì¸

4. í¬íŠ¸ í™•ì¸: Redisê°€ 6379 í¬íŠ¸ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸

  

### 9.2 ë©”ëª¨ë¦¬ ë¶€ì¡±

  

**ì¦ìƒ**: `OOM command not allowed when used memory > 'maxmemory'`

  

**í•´ê²° ë°©ë²•**:

1. TTL í™•ì¸ ë° ì¡°ì •

2. ë¶ˆí•„ìš”í•œ í‚¤ ì‚­ì œ: `redis-cli --scan --pattern "old:*" | xargs redis-cli DEL`

3. `maxmemory-policy` ì„¤ì • ì¡°ì •

  

### 9.3 ì„±ëŠ¥ ì €í•˜

  

**ì¦ìƒ**: Redis ì‘ë‹µ ì‹œê°„ ì¦ê°€

  

**í•´ê²° ë°©ë²•**:

1. Connection Pool í¬ê¸° ì¡°ì •

2. ë„¤íŠ¸ì›Œí¬ ì§€ì—° í™•ì¸

3. Redis ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸

4. ëŠë¦° ì¿¼ë¦¬ ë¡œê·¸ í™•ì¸: `SLOWLOG GET 10`

  

---

  

## 10. ì°¸ê³  ìë£Œ

  

- [Spring Data Redis ê³µì‹ ë¬¸ì„œ](https://spring.io/projects/spring-data-redis)

- [Redis ê³µì‹ ë¬¸ì„œ](https://redis.io/documentation)

- [í”„ë¡œì íŠ¸ Redis ìºì‹œ ì „ëµ](./FRONTEND_BACKEND_CONNECTION_STRATEGY.md#redis-ìºì‹œ-ì „ëµ)

  

---

  

## 11. ìš”ì•½

  

### âœ… êµ¬í˜„ ì™„ë£Œ ì‚¬í•­

  

- [x] Docker Composeì— Redis ì„œë¹„ìŠ¤ ì¶”ê°€

- [x] ëª¨ë“  Spring ì„œë¹„ìŠ¤ì— Redis í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€

- [x] Redis Health Check ì„¤ì •

- [x] Redis ë°ì´í„° ì˜êµ¬ ì €ì¥ (AOF) ì„¤ì •

- [x] ë„¤íŠ¸ì›Œí¬ ë° ì˜ì¡´ì„± ì„¤ì •

  

### ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„

  

1. **Spring Boot ì„¤ì •**: ê° ì„œë¹„ìŠ¤ì— `RedisConfig` í´ë˜ìŠ¤ ì¶”ê°€

2. **ì˜ì¡´ì„± ì¶”ê°€**: `build.gradle`ì— Redis ì˜ì¡´ì„± ì¶”ê°€

3. **í† í° ê´€ë¦¬ êµ¬í˜„**: `TokenService`ì— Redis í†µí•©

4. **ìºì‹œ ë ˆì´ì–´ êµ¬í˜„**: ì„œë¹„ìŠ¤ë³„ ìºì‹œ ì „ëµ ì ìš©

5. **Rate Limiting êµ¬í˜„**: Discovery Serverì— Rate Limiting í•„í„° ì¶”ê°€

6. **í…ŒìŠ¤íŠ¸**: ë¡œì»¬ í™˜ê²½ì—ì„œ ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸

  

---

  

**ì‘ì„±ì**: AI Assistant Â 

**ê²€í†  í•„ìš”**: Redis ì„¤ì • ë° ë³´ì•ˆ ì •ì±… ìµœì¢… ê²€í†  í•„ìš”